#!/bin/sh

PATH=/bin

. /etc/rc.conf

case "$1" in
reboot|poweroff)
	;;
*)
	echo "Invalid action '$1' for rc.shutdown" 1>&2
	exit 1
	;;
esac

echo Shutting down

hwclock -u -w

svc -k

killall5 -15
sleep 5
killall5 -9

echo Storing random seed
dd if=/dev/urandom of=/etc/random-seed count=1 bs=512 2>/dev/null

echo Mounting root read-only
mount -o remount,ro /

sync
sleep 3
wait

echo bye

case "$1" in
reboot)
	halt -r
	;;
poweroff)
	halt -p
	;;
esac
