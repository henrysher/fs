#!/bin/sh

PATH=/bin

. /etc/rc.conf

echo Shutting down

hwclock -u -w

echo $SVC | sed 's/ /\n/g' | tac | while read s; do
	echo Stopping $s
	/bin/rc.d/$s -k
done

killall5 -15
sleep 5
killall5 -9

echo Storing random seed
dd if=/dev/urandom of=/etc/random-seed count=1 bs=512 2>/dev/null

echo Mounting root read-only
mount -o remount,ro /

sync
sleep 3
wait

echo bye

if test "$1" = "reboot"; then
	halt -r
else
	halt -p
fi
